<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPA Guyana Act and Regulations Navigator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#10B981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="EPA Navigator">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .search-container { max-width: 800px; margin: 0 auto; }
        .result-item { border-left: 4px solid #10B981; transition: all 0.3s ease; }
        .result-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .loader { border-top-color: #10B981; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #install-prompt { display: none; position: fixed; bottom: 1rem; left: 50%; transform: translateX(-50%); z-index: 100; }
        .subsection { border-top: 1px solid #e5e7eb; padding-top: 0.75rem; margin-top: 0.75rem; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-5xl font-bold text-gray-900 mb-2">EPA Guyana Act and Regulations Navigator</h1>
            <p class="text-md md:text-lg text-gray-600">Your guide to the Environmental Protection Act and Regulations of Guyana</p>
        </header>

        <main>
            <div class="search-container bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200">
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="searchInput" placeholder="E.g., 'What are the penalties for littering?'" class="flex-grow w-full px-5 py-3 text-base text-gray-700 placeholder-gray-400 bg-gray-100 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition">
                    <button id="searchButton" class="w-full sm:w-auto bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-8 rounded-xl transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 flex items-center justify-center">
                        <svg id="searchIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <div id="loader" class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 hidden mr-2"></div>
                        <span id="buttonText">Search</span>
                    </button>
                </div>
            </div>

            <div id="results" class="mt-8 md:mt-12 space-y-6"></div>
             <div id="noResults" class="hidden text-center mt-12">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="mt-4 text-lg font-medium text-gray-900">No relevant sections found</h3>
                <p class="mt-1 text-sm text-gray-500">Try searching with different keywords.</p>
            </div>
        </main>
    </div>

    <div id="install-prompt" class="bg-gray-800 text-white py-3 px-6 rounded-lg shadow-xl flex items-center gap-4">
        <p>Install this app for offline access!</p>
        <button id="install-button" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-md">Install</button>
    </div>

    <script>
        // --- PWA Service Worker Registration ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js') // Points to your service worker file
                    .then(registration => console.log('ServiceWorker registration successful.'))
                    .catch(err => console.log('ServiceWorker registration failed: ', err));
            });
        }

        // --- PWA Install Prompt ---
        let deferredPrompt;
        const installPromptDiv = document.getElementById('install-prompt');
        const installButton = document.getElementById('install-button');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPromptDiv.style.display = 'flex';
        });

        installButton.addEventListener('click', async () => {
            installPromptDiv.style.display = 'none';
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to the install prompt: ${outcome}`);
            deferredPrompt = null;
        });


        // --- Application Logic ---
        const searchButton = document.getElementById('searchButton');
        const searchInput = document.getElementById('searchInput');
        const resultsDiv = document.getElementById('results');
        const noResultsDiv = document.getElementById('noResults');
        const loader = document.getElementById('loader');
        const buttonText = document.getElementById('buttonText');
        const searchIcon = document.getElementById('searchIcon');

        const epaActSections = {
            "ENVIRONMENTAL PROTECTION ACT": {
                "Section 19: Prevention of pollution": [
                    { "title": "Subsection (1)", "content": "A person shall not— (a) undertake an activity that causes or is likely to cause pollution of the environment unless the person takes all reasonable and practicable measures to prevent or minimise any resulting adverse effect; (b) discharge or cause or permit the entry into the environment, of any contaminant in any amount, concentration or level in excess of that prescribed by the regulations or stipulated by any environmental authorisation." },
                    { "title": "Subsection (2)", "content": "(a) Any person who contravenes subsection (1)(a) shall be guilty of an offence and shall be liable to the penalties prescribed under paragraph (f) of the Fifth Schedule, (b) Any person who contravenes subsection (1)(b) shall be guilty of an offence and shall be liable to the penalties prescribed under paragraph (e) of the Fifth Schedule." },
                    { "title": "Subsection (3)", "content": "Where subsection (1) is contravened the person responsible for the contaminant or for the process involving the contaminant or who causes or permits a discharge in contravention of subsection (1) shall - (a) immediately notify the Agency of the discharge, its circumstances, and actions taken; (b) restore the natural environment by cleaning up, removing, or neutralising the contaminant; (c) be liable for the cost of an independent investigation; (d) deposit a sum of money with the Agency to cover estimated restoration costs; (e) be liable to compensate any person who suffers loss or damage; and (f) do everything practicable to preserve evidence of the effects of the discharge." }
                ],
                "Section 39: Damage to environment": [
                    { "title": "Subsection (1)", "content": "Every person who causes material environmental harm by polluting the environment intentionally or recklessly and with the 'knowledge that material environmental harm will or might result is guilty of an offence and shall be liable to the penalties prescribed under paragraph (f) of the Fifth Schedule." },
                    { "title": "Subsection (2)", "content": "Every person who causes material environmental harm by polluting the environment is guilty of an offence and shall be liable to the penalties prescribed under paragraph (e) of the Fifth Schedule." },
                    { "title": "Subsection (3)", "content": "Every person who causes serious environmental harm by polluting the environment intentionally or recklessly and with the knowledge that serious environmental harm will or might result is guilty of an offence and shall be liable to the penalties prescribed under paragraph (h) of the Fifth Schedule." },
                    { "title": "Subsection (4)", "content": "Every person who causes serious environmental harm by polluting the environment is guilty of an offence and shall be liable to the penalties prescribed under paragraph (f) of the Fifth Schedule." },
                    { "title": "Subsection (5)", "content": "Environmental harm is to be treated as material environmental harm if— (i) it consists of an environmental nuisance of a high impact or on a wide scale; or (ii) it involves actual or potential harm to the health or safety of human beings that is not trivial, or other actual or potential environmental harm (not being merely an environmental nuisance) that is not trivial." },
                    { "title": "Subsection (6)", "content": "Environmental harm is to be treated as serious environmental harm if it involves actual or potential harm to the health or safety of human beings that is of a high impact or on a wide scale, or other actual or potential environmental harm (not being merely an environmental nuisance) that is of a high impact or on a wide scale." }
                ]
            },
            "LITTER ENFORCEMENT REGULATIONS 2013": {
                "Regulation 3: Depositing litter in a public place": [
                    { "title": "Subsection (1)", "content": "A person who, without reasonable excuse, deposits litter (advertently or inadvertently) in or on any public place, other than in a receptacle placed for the purpose of collecting it or at any approved site leaves such litter there, is guilty of an offence under this Regulations." },
                    { "title": "Subsection (3)", "content": "Where litter is deposited from a motor vehicle, other than a bus or taxi when plying for hire or from a trailer, on to a public place contrary to subsection (1) and it cannot be determined which of the occupants of the motor vehicle or trailer is responsible for the said litter, the driver of the motor vehicle shall be deemed to be the person who deposited the litter from the motor vehicle or trailer." },
                    { "title": "Subsection (6)", "content": "A person who is guilty of an offence under this Regulation is liable on summary conviction of:- (a) in the case of an individual, to a fine of fifty thousand dollars; or (b) in the case of a body corporate to a fine of one hundred thousand dollars." }
                ],
                "Regulation 4: Littering from motor vehicle or trailer in motion": [
                    { "title": "Subsection (1)", "content": "A person who transports in or on a motor vehicle or trailer along a public place, any substance or material which is likely to fall off or blow off from the motor vehicle or trailer shall be guilty of an offence under this Regulations where, while being so transported it is either- (a) not sufficiently well secured as to prevent it from falling off the motor vehicle or trailer, or (b) not so covered as to prevent it from blowing off the motor vehicle or trailer." },
                    { "title": "Subsection (2)", "content": "A person who is guilty of an offence under this regulation is liable on summary conviction of: (a) in the case of an individual to a fine of fifty thousand dollars; (b) or in the case of a body corporate to a fine of one hundred thousand dollars." }
                ]
            },
            "EXPANDED POLYSTYRENE BAN REGULATIONS 2015": {
                "Regulation 5: Prohibition": [
                    { "title": "Subsection (1)", "content": "The importation, manufacture, sale or offer for sale of expanded polystyrene products in Guyana is hereby prohibited." },
                    { "title": "Subsection (2)", "content": "Any person or entity found to be in contravention of Regulation 5(1) shall be liable upon summary conviction to a fine of no less than fifty thousand dollars." }
                ],
                "Regulation 6: Prohibition of sale by Food Service Establishments": [
                    { "title": "Subsection (1)", "content": "No Food Service Establishment shall sell or provide food for consumption, either on or off the said Establishment's premises, in expanded polystyrene food service products." },
                    { "title": "Subsection (2)", "content": "The provisions of Regulation 6(1) shall not apply to prepackaged food that a Food Service Establishment sells or otherwise provides for consumption in expanded polystyrene containers that have been filled and sealed prior to receipt by the Food Service Establishment." }
                ]
            },
            "NOISE MANAGEMENT REGULATIONS 2000": {
                "Regulation 13: Offence to cause loud, etc. noise in buildings or premises": [
                    { "title": "Full Text", "content": "Any person who is the proprietor, occupier or person having charge of any building, private premises or any part thereof or any vehicle, at any time causes or suffers or allows any loud, unnecessary, excessive or unusual noises in the operation of any sound-making device or equipment so that the noise or music is plainly audible at a distance of fifty feet from the vehicle or premises in which or from which it is produced commits an offence and shall be liable on summary conviction to a fine of not less than three hundred thousand dollars nor more than seven hundred and fifty thousand dollars and to imprisonment for one year." }
                ]
            },
            "HAZARDOUS WASTE MANAGEMENT REGULATIONS 2000": {
                "Regulation 26: Contamination of any place": [
                    { "title": "Full Text", "content": "Every person who willfully or negligently and with the knowledge that serious environmental harm will or might result causes the contamination of any place, except a declared hazardous waste disposal site, shall be guilty of an offence and shall be liable on summary conviction to a fine of not less than eight hundred thousand dollars nor more than two million dollars and to imprisonment for five years." }
                ]
            }
        };

        const performSearch = () => {
            const query = searchInput.value.toLowerCase().trim();
            if (!query) {
                resultsDiv.innerHTML = '<p class="text-center text-gray-500">Please enter a question to search.</p>';
                noResultsDiv.classList.add('hidden');
                return;
            }

            loader.classList.remove('hidden');
            searchIcon.classList.add('hidden');
            buttonText.textContent = 'Searching...';
            searchButton.disabled = true;
            searchInput.disabled = true;
            resultsDiv.innerHTML = '';
            noResultsDiv.classList.add('hidden');

            setTimeout(() => {
                const keywords = query.split(/\s+/).filter(word => word.length > 2);
                let searchResults = [];

                for (const part in epaActSections) {
                    for (const section in epaActSections[part]) {
                        const subsections = epaActSections[part][section];
                        let matchingSubsections = [];
                        let totalScore = 0;

                        subsections.forEach(subsection => {
                            const content = subsection.content.toLowerCase();
                            const subTitle = subsection.title.toLowerCase();
                            const sectionTitle = section.toLowerCase();
                            const partTitle = part.toLowerCase();
                            let score = 0;

                            keywords.forEach(keyword => {
                                if (content.includes(keyword)) score += 2;
                                if (subTitle.includes(keyword)) score += 8;
                                if (sectionTitle.includes(keyword)) score += 5;
                                if (partTitle.includes(keyword)) score += 4;
                            });

                            if (query.includes("penalty") || query.includes("fine")) {
                                if (subTitle.includes("penalty") || content.includes("fine")) score += 15;
                            }
                             if (query.includes("litter") && partTitle.includes("litter")) score += 10;
                             if (query.includes("styrofoam") && partTitle.includes("polystyrene")) score += 15;

                            if (score > 0) {
                                matchingSubsections.push({ ...subsection, score });
                                totalScore += score;
                            }
                        });

                        if (matchingSubsections.length > 0) {
                            searchResults.push({
                                part,
                                section,
                                subsections: matchingSubsections,
                                score: totalScore
                            });
                        }
                    }
                }

                searchResults.sort((a, b) => b.score - a.score);

                if (searchResults.length > 0) {
                    displayResults(searchResults.slice(0, 4));
                } else {
                    noResultsDiv.classList.remove('hidden');
                }

                loader.classList.add('hidden');
                searchIcon.classList.remove('hidden');
                buttonText.textContent = 'Search';
                searchButton.disabled = false;
                searchInput.disabled = false;

            }, 1000);
        };

        const displayResults = (results) => {
            resultsDiv.innerHTML = results.map(result => {
                const subsectionsHtml = result.subsections.map(sub => `
                    <div class="subsection">
                        <h4 class="font-semibold text-gray-700">${sub.title}</h4>
                        <p class="text-gray-600 leading-relaxed">${highlightKeywords(sub.content, searchInput.value)}</p>
                    </div>
                `).join('');

                return `
                    <div class="result-item bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <span class="inline-block bg-emerald-100 text-emerald-800 text-xs font-semibold px-3 py-1 rounded-full mb-3">${result.part}</span>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${result.section}</h3>
                        ${subsectionsHtml}
                    </div>
                `;
            }).join('');
        };

        const highlightKeywords = (text, query) => {
            const keywords = query.toLowerCase().split(/\s+/).filter(word => word.length > 2);
            let highlightedText = text;
            keywords.forEach(keyword => {
                const regex = new RegExp(`(${keyword})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<strong class="bg-emerald-100 font-semibold">$1</strong>');
            });
            return highlightedText;
        };

        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                performSearch();
            }
        });
    </script>

</body>
</html>
